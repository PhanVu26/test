<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Stock Manager</title>
<style>
  body{margin:0;font-family:-apple-system,system-ui,sans-serif;background:#0e1117;color:#f1f5f9}
  header{padding:12px;text-align:center;background:#1e293b;font-size:18px;font-weight:600}
  nav{display:flex;justify-content:space-around;background:#1e293b}
  nav button{flex:1;padding:12px;background:none;border:none;color:#94a3b8;font-weight:600;font-size:15px}
  nav button.active{color:#2dd4bf;border-bottom:3px solid #2dd4bf}
  .page{display:none;padding:16px}
  .page.active{display:block}
  .card{background:#1e293b;border-radius:10px;padding:16px;margin-bottom:12px;box-shadow:0 2px 6px rgba(0,0,0,.4)}
  label{font-size:14px;color:#94a3b8;display:block;margin-bottom:4px}
  input,select{width:100%;padding:10px;margin-bottom:12px;border-radius:8px;border:none;font-size:16px}
  button.action{width:100%;padding:12px;border:none;border-radius:8px;background:#2dd4bf;color:#03202b;font-weight:600;font-size:16px;margin-top:8px}
  table{width:100%;border-collapse:collapse;font-size:14px}
  th,td{padding:8px;text-align:left;border-bottom:1px solid #334155}
  h3{margin-top:0;font-size:16px}
</style>
</head>
<body>
<header>Stock Manager</header>
<nav>
  <button class="tab active" data-page="trade">Vào lệnh</button>
  <button class="tab" data-page="journal">Nhật ký</button>
  <button class="tab" data-page="settings">Cài đặt</button>
</nav>

<!-- PAGE TRADE -->
<div id="trade" class="page active">
  <div class="card">
    <label>Mã CP</label>
    <input id="symbol" placeholder="VD: VCB">
    <label>Giá Entry</label>
    <input id="entry" type="number">
    <label>Loại Stop Loss</label>
    <select id="stopType">
      <option value="5">5%</option>
      <option value="8" selected>8%</option>
      <option value="10">10%</option>
      <option value="custom">Tùy chỉnh</option>
    </select>
    <input id="customStop" type="number" placeholder="Giá stop (nếu tùy chỉnh)" style="display:none">
    <button class="action" onclick="calc()">Tính toán</button>
    <div id="result" style="margin-top:12px;font-size:15px"></div>
  </div>
</div>

<!-- PAGE JOURNAL -->
<div id="journal" class="page">
  <div class="card">
    <h3>Nhật ký giao dịch</h3>
    <table id="journalTable">
      <thead><tr><th>Ngày</th><th>Mã</th><th>Entry</th><th>Stop</th><th>Qty</th></tr></thead>
      <tbody></tbody>
    </table>
    <button class="action" onclick="exportCSV()">Xuất CSV</button>
  </div>
</div>

<!-- PAGE SETTINGS -->
<div id="settings" class="page">
  <div class="card">
    <label>Vốn (VND)</label>
    <input id="capital" type="number" value="25000000">
    <label>% Rủi ro / lệnh</label>
    <input id="risk" type="number" value="1">
    <label>Even lot</label>
    <input id="lot" type="number" value="100">
    <button class="action" onclick="saveSettings()">Lưu</button>
  </div>
</div>

<script>
let settings = {capital:25000000,risk:1,lot:100};
let journal = [];

function calc(){
  const sym=document.getElementById('symbol').value.toUpperCase();
  const entry=+document.getElementById('entry').value;
  if(!sym||entry<=0){alert("Nhập mã CP và giá hợp lệ!");return;}
  let stop;
  const type=document.getElementById('stopType').value;
  if(type==='custom'){stop=+document.getElementById('customStop').value;}
  else{stop=entry*(1-type/100);}
  const riskMoney=settings.capital*(settings.risk/100);
  const riskPerShare=Math.abs(entry-stop);
  const qty=Math.floor(riskMoney/riskPerShare/settings.lot)*settings.lot;
  document.getElementById('result').innerHTML=`
    Stop = ${stop.toFixed(0)}₫<br>
    Risk/share = ${riskPerShare.toFixed(0)}₫<br>
    Qty = ${qty} cp<br>
    Tổng vốn ~ ${(qty*entry).toLocaleString()}₫
  `;
  if(qty>0){
    journal.push({date:new Date().toLocaleString(),symbol:sym,entry,stop,qty});
    renderJournal();
  }
}

function renderJournal(){
  const tbody=document.querySelector('#journalTable tbody');
  tbody.innerHTML='';
  journal.forEach(j=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${j.date}</td><td>${j.symbol}</td><td>${j.entry}</td><td>${j.stop}</td><td>${j.qty}</td>`;
    tbody.appendChild(tr);
  });
}

function saveSettings(){
  settings.capital=+document.getElementById('capital').value;
  settings.risk=+document.getElementById('risk').value;
  settings.lot=+document.getElementById('lot').value;
  alert('Đã lưu cài đặt');
}

function exportCSV(){
  let csv="Ngày,Mã,Entry,Stop,Qty\n";
  journal.forEach(j=>{
    csv+=`${j.date},${j.symbol},${j.entry},${j.stop},${j.qty}\n`;
  });
  const blob=new Blob([csv],{type:'text/csv'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url;a.download="journal.csv";a.click();
  URL.revokeObjectURL(url);
}

document.getElementById('stopType').onchange=e=>{
  document.getElementById('customStop').style.display=(e.target.value==='custom'?'block':'none');
};
document.querySelectorAll('.tab').forEach(btn=>{
  btn.onclick=()=>{
    document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'));
    document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById(btn.dataset.page).classList.add('active');
  };
});
</script>
</body>
</html>